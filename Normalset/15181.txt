 zhiyang and zhiyun vince told me that london has some trouble to calculate spread option for correlvol vol in such a case the effective volatility becomes zero and the option has zero time value i have modified the unitcorrpremium routine to force the code to treat this situation as a special case it returns the discounted intrinsic value please incorporate this chang to your code so that it will no longer cause any problems that should not happen in the first place if you have any questions please let me know zimindouble unitcorrpremium double s double s double strike double r double q double q double vol double vol double correl double tmat int opttype double retval; if tmat return intrinsic s s strike opttype ; look right here for the change only two lines ifcorreltiny fabs volvoltiny for vol vol correlcase return intrinsic s s strike opttype exp r tmat ; setup s s strike r q q vol vol correl tmat ; if opttype retval s disc gauherint ffuncc sqrtpi; else retval s disc gauherint ffuncp sqrtpi; return retval;